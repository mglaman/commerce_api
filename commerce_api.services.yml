services:
  commerce_api.jsonapi_controller_shim:
    parent: jsonapi.entity_resource
    class: Drupal\commerce_api\EntityResourceShim
  access_check.cart_api:
    class: Drupal\commerce_api\Access\CartApiAccessCheck
    arguments: ['@commerce_cart.cart_provider']
    tags:
      - { name: access_check, applies_to: _cart_api }

  commerce_api.field_access:
    class: Drupal\commerce_api\FieldAccess
    arguments: ['@current_route_match']

  commerce_api.cart_token_session:
    class: Drupal\commerce_api\CartTokenSession
    decorates: commerce_cart.cart_session
    public: false
    arguments: ['@commerce_api.cart_token_session.inner', '@request_stack', '@tempstore.shared']
  commerce_api.cart_token_session_configuration:
    class: Drupal\commerce_api\Session\CartTokenSessionConfiguration
    decorates: session_configuration
    public: false
    arguments: ['@commerce_api.cart_token_session_configuration.inner']
  commerce_api.token_cart_convert_subscriber:
    class: Drupal\commerce_api\EventSubscriber\CartTokenSubscriber
    arguments: ['@commerce_cart.cart_session', '@tempstore.shared']
    tags:
      - { name: event_subscriber }

  # @see https://www.drupal.org/project/commerce/issues/3088598
  commerce_api.published_availability_checker:
    class: Drupal\commerce_api\AvailabilityChecker\PublishedAvailabilityChecker
    tags:
      - { name: commerce.availability_checker }

  commerce_api.normalizer.decorated_resource_object_normalizer:
    class: Drupal\jsonapi\Normalizer\JsonapiImpostor\DecoratedResourceObjectNormalizer
    decorates: serializer.normalizer.resource_object.jsonapi
    parent: serializer.normalizer.resource_object.jsonapi
  # This tag is commented out because it breaks the namespace impostor workaround. However, this tag is manually replicated in the JsonApiHypermediaServiceProvider.
  # tags:
  #   - { name: service_collector, tag: jsonapi_hypermedia_provider, call: addHypermediaProvider }
